# 성능 규칙

> 카테고리: PERF-RULE
> 이 문서의 규칙은 쿼리 최적화, 캐시, 인덱스, 응답 시간 목표를 정의합니다.

## 쿼리 최적화

### RULE-PERF-001: 불필요한 쿼리 금지
- **원칙**: 동일한 데이터를 반복 조회하지 않는다
- **위반 기준**: 같은 요청 내에서 동일한 쿼리가 2회 이상 실행되면 위반
- **검증 방법**: 쿼리 로그에서 중복 쿼리 확인
- **예외**: 트랜잭션 격리가 요구하는 경우

### RULE-PERF-002: 쿼리 결과 제한
- **원칙**: 대량 데이터 조회 시 반드시 LIMIT/TOP을 사용한다
- **위반 기준**: LIMIT 없이 전체 테이블을 조회하면 위반
- **검증 방법**: SELECT 쿼리에 LIMIT 또는 페이지네이션 존재 확인
- **예외**: 집계(COUNT, SUM 등) 쿼리, 배치 처리 (명시적 문서화 필요)

## 캐시

### RULE-PERF-010: 캐시 전략
- **원칙**: {{CACHE_STRATEGY_DESC}}
- **위반 기준**: 정해진 캐시 전략을 따르지 않으면 위반
- **검증 방법**: 캐시 설정 및 TTL 확인
- **예외**: 실시간 데이터, 트랜잭션 데이터

### RULE-PERF-011: 캐시 무효화
- **원칙**: 데이터 변경 시 관련 캐시를 반드시 무효화한다
- **위반 기준**: 데이터 수정 후 캐시가 갱신되지 않으면 위반
- **검증 방법**: 데이터 변경 로직에 캐시 무효화 코드 존재 확인
- **예외**: TTL 기반 자동 만료로 충분한 경우

## 응답 시간

### RULE-PERF-020: API 응답 시간 목표
- **원칙**: {{RESPONSE_TIME_DESC}}
- **위반 기준**: 응답 시간이 목표치를 초과하면 위반
- **검증 방법**: 성능 테스트 또는 모니터링에서 응답 시간 확인
- **예외**: 배치 처리, 파일 업로드/다운로드, 외부 API 호출이 포함된 경우

### RULE-PERF-021: 비동기 처리
- **원칙**: {{ASYNC_POLICY_DESC}}
- **위반 기준**: 오래 걸리는 작업을 동기적으로 처리하면 위반
- **검증 방법**: 무거운 오퍼레이션에 비동기 처리(큐, 이벤트) 사용 확인
- **예외**: 3초 이내로 완료되는 작업

## 리소스 관리

### RULE-PERF-030: 커넥션 풀
- **원칙**: 외부 리소스(DB, HTTP 클라이언트)에 커넥션 풀을 사용한다
- **위반 기준**: 요청마다 새 커넥션을 생성/해제하면 위반
- **검증 방법**: DB/HTTP 클라이언트 설정에서 풀 사용 확인
- **예외**: 일회성 스크립트, 배치 작업

{{#if CUSTOM_PERF_RULES}}
## 프로젝트 커스텀 성능 규칙

{{CUSTOM_PERF_RULES}}
{{/if}}
