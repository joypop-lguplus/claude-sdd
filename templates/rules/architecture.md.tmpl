# 아키텍처 규칙

> 카테고리: ARCH
> 이 문서의 규칙은 프로젝트의 모듈 구조, 의존성 방향, 계층 분리를 정의합니다.

{{#if ARCH_HEXAGONAL}}
## 헥사고날 아키텍처

### RULE-ARCH-001: Port-Adapter 패턴
- **원칙**: 모든 모듈은 Port-Adapter 패턴을 따른다
- **위반 기준**: 도메인 로직이 인프라 계층에 직접 의존하면 위반
- **검증 방법**: import 방향 확인 — domain 패키지는 infra를 import하지 않음
- **예외**: 없음

### RULE-ARCH-002: 포트 인터페이스 정의
- **원칙**: 외부 시스템과의 통신은 포트(인터페이스)를 통해서만 수행한다
- **위반 기준**: 도메인 계층에서 외부 라이브러리(HTTP 클라이언트, DB 드라이버 등)를 직접 호출하면 위반
- **검증 방법**: 도메인 모듈의 import 문에 인프라 라이브러리가 없는지 확인
- **예외**: 표준 라이브러리(java.util, lodash 등)는 허용
{{/if}}

{{#if ARCH_LAYERED}}
## 계층형 아키텍처

### RULE-ARCH-001: 계층 의존성 방향
- **원칙**: 상위 계층만 하위 계층에 의존한다 (Controller → Service → Repository)
- **위반 기준**: 하위 계층이 상위 계층을 import하면 위반
- **검증 방법**: import/require 방향이 Controller→Service→Repository→Entity 순인지 확인
- **예외**: 없음

### RULE-ARCH-002: 계층 건너뛰기 금지
- **원칙**: Controller에서 Repository를 직접 호출하지 않는다
- **위반 기준**: Controller 코드에서 Repository 클래스/함수를 직접 사용하면 위반
- **검증 방법**: Controller 파일에서 Repository import/사용 여부 확인
- **예외**: 없음
{{/if}}

{{#if ARCH_DDD}}
## DDD (도메인 주도 설계)

### RULE-ARCH-001: Bounded Context 분리
- **원칙**: 각 도메인(Bounded Context)은 독립적인 모듈로 분리한다
- **위반 기준**: 한 도메인이 다른 도메인의 내부 구현에 직접 의존하면 위반
- **검증 방법**: 도메인 간 의존은 공개 인터페이스(API, 이벤트)를 통해서만 가능한지 확인
- **예외**: 공유 커널(Shared Kernel)에 정의된 공통 타입은 허용

### RULE-ARCH-002: Aggregate Root
- **원칙**: 엔티티 접근은 Aggregate Root를 통해서만 수행한다
- **위반 기준**: Aggregate 내부 엔티티를 외부에서 직접 조작하면 위반
- **검증 방법**: Repository가 Aggregate Root만 반환하는지 확인
- **예외**: 읽기 전용 쿼리(CQRS Query)는 DTO로 직접 조회 가능
{{/if}}

### RULE-ARCH-010: 모듈 구조
- **원칙**: {{MODULE_STRUCTURE_DESC}}
- **위반 기준**: 정해진 디렉토리 구조를 따르지 않으면 위반
- **검증 방법**: 소스 파일 위치가 정해진 디렉토리 구조를 따르는지 확인
- **예외**: 설정 파일, 스크립트 등 비소스 파일

### RULE-ARCH-011: 의존성 주입
- **원칙**: 컴포넌트 간 의존성은 DI(의존성 주입)를 통해 관리한다
- **위반 기준**: 클래스 내부에서 의존 객체를 직접 생성(new)하면 위반
- **검증 방법**: 생성자/팩토리를 통한 의존성 주입 패턴 확인
- **예외**: 값 객체(VO), DTO, 유틸리티 클래스

{{#if CUSTOM_ARCH_RULES}}
## 프로젝트 커스텀 아키텍처 규칙

{{CUSTOM_ARCH_RULES}}
{{/if}}
