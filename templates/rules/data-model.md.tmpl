# 데이터 모델 규칙

> 카테고리: DM-RULE
> 이 문서의 규칙은 엔티티 설계, 마이그레이션, 쿼리 패턴을 정의합니다.

## 엔티티 설계

### RULE-DM-001: 엔티티 ID 전략
- **원칙**: {{ID_STRATEGY_DESC}}
- **위반 기준**: 정해진 ID 생성 전략을 따르지 않으면 위반
- **검증 방법**: 엔티티의 ID 필드 타입과 생성 전략 확인
- **예외**: 외부 시스템 연동 시 외부 ID 사용

### RULE-DM-002: 필수 공통 필드
- **원칙**: {{COMMON_FIELDS_DESC}}
- **위반 기준**: 엔티티에 필수 공통 필드(id, createdAt, updatedAt 등)가 누락되면 위반
- **검증 방법**: 엔티티/모델 정의에서 공통 필드 존재 확인
- **예외**: 중간 테이블(join table), 임베디드 값 객체

### RULE-DM-003: 필드 타입 명시
- **원칙**: 모든 필드에 명확한 타입과 제약 조건(nullable, length, precision 등)을 정의한다
- **위반 기준**: 필드에 타입이 누락되거나, 제약 조건이 불명확하면 위반
- **검증 방법**: 엔티티/DDL 정의에서 타입과 제약 조건 확인
- **예외**: 없음

## 관계

### RULE-DM-010: 외래 키 제약
- **원칙**: {{FK_POLICY_DESC}}
- **위반 기준**: 정해진 외래 키 정책을 따르지 않으면 위반
- **검증 방법**: DDL/마이그레이션에서 FK 정의 확인
- **예외**: 없음

### RULE-DM-011: N+1 쿼리 방지
- **원칙**: 연관 엔티티 조회 시 N+1 쿼리가 발생하지 않도록 한다
- **위반 기준**: 루프 내에서 연관 엔티티를 개별 조회하면 위반
- **검증 방법**: 쿼리 로그 또는 ORM의 eager/lazy 로딩 설정 확인
- **예외**: 페이지네이션된 소량 데이터

## 마이그레이션

### RULE-DM-020: 마이그레이션 스크립트
- **원칙**: 스키마 변경은 반드시 마이그레이션 스크립트를 통해 수행한다
- **위반 기준**: DB에 직접 DDL을 실행하거나, 마이그레이션 없이 스키마를 변경하면 위반
- **검증 방법**: 스키마 변경에 대응하는 마이그레이션 파일 존재 확인
- **예외**: 개발 환경에서의 스키마 동기화 (ORM auto-sync)

### RULE-DM-021: 롤백 가능성
- **원칙**: 모든 마이그레이션은 롤백 스크립트를 포함한다
- **위반 기준**: 롤백 스크립트 없이 마이그레이션만 존재하면 위반
- **검증 방법**: 마이그레이션 파일에 up/down 또는 rollback 코드 존재 확인
- **예외**: 데이터 파괴적 변경이 불가역적인 경우 (명시적 문서화 필요)

## 인덱스

### RULE-DM-030: 인덱스 전략
- **원칙**: {{INDEX_STRATEGY_DESC}}
- **위반 기준**: 주요 쿼리 패턴에 대응하는 인덱스가 없으면 위반
- **검증 방법**: 쿼리 패턴과 인덱스 정의 대조
- **예외**: 소량 데이터 테이블 (1만건 이하)

{{#if CUSTOM_DM_RULES}}
## 프로젝트 커스텀 데이터 모델 규칙

{{CUSTOM_DM_RULES}}
{{/if}}
